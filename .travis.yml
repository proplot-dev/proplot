# Travis Continuous Integration
# Mamba links:
# https://mamba.readthedocs.io/en/latest/installation.html
# Sample travis file:
# https://conda.pydata.org/docs/travis.html
# Avoiding duplicate branch-pr triggers:
# https://github.com/travis-ci/travis-ci/issues/1147#issuecomment-160820262
dist: xenial
sudo: false  # use container based build
language: python

notifications:
  email: false

branches:
  only:
    - master

python:
  - "3.7"

before_install:
  - |
        MODIFIED_FILES=$(git diff --name-only "$TRAVIS_COMMIT_RANGE" 2>/dev/null)
        if [ $? -eq 0 ] && ! echo "$MODIFIED_FILES" | grep -qvE '(.md)|(.rst)|(.html)|(.png)|(.ico)'
          then
          echo "Only doc files were updated, not running the CI."
          exit
        fi
  - curl micro.mamba.pm/install.sh | bash
  - export PATH="$HOME/micromamba/bin:$PATH"
  - micromamba config set always_yes true
  - micromamba config set changeps1 false
  - micromamba config set show_channel_urls true
  - micromamba shell init --shell=bash --prefix=~/micromamba

install:
  - . ~/.bashrc
  - which python
  - which micromamba
  - micromamba env create --file ci/environment.yml
  - micromamba activate proplot-dev
  - python setup.py sdist bdist_wheel
  - pip install --user ./dist/*.whl
  - micromamba list

script:
  - ci/run-linter.sh
